<svg xmlns="http://www.w3.org/2000/svg" width="1500" height="900" viewBox="0 0 1500 900" role="img" aria-labelledby="title desc">
  <title id="title">AF Memory Flow</title>
  <desc id="desc">Diagram showing core read-generate-write pipeline and multi-level context providers for Agent Framework memory.</desc>
  <style>
    .title { font: 36px sans-serif; font-weight: 600; fill: #111827; }
    .section { font: 22px sans-serif; font-weight: 600; fill: #111827; }
    .label { font: 18px sans-serif; fill: #111827; }
    .small { font: 16px sans-serif; fill: #374151; }
    .box { fill: #f3f4f6; stroke: #9ca3af; stroke-width: 2; rx: 10; ry: 10; }
    .arrow { stroke: #2563eb; stroke-width: 4; marker-end: url(#arrowhead); }
    .arrow2 { stroke: #10b981; stroke-width: 4; marker-end: url(#arrowhead); }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" fill="#374151">
      <polygon points="0 0, 10 5, 0 10" />
    </marker>
  </defs>

  <text x="750" y="60" text-anchor="middle" class="title">AF Memory Flow</text>

  <rect x="80" y="110" width="640" height="700" class="box" />
  <text x="400" y="150" text-anchor="middle" class="section">1) Read → Generate → Write (single agent, Mem0 provider)</text>

  <rect x="120" y="190" width="150" height="60" class="box" />
  <text x="195" y="225" text-anchor="middle" class="label">User Input</text>

  <rect x="320" y="190" width="170" height="60" class="box" />
  <text x="405" y="225" text-anchor="middle" class="label">Agent (Thread)</text>

  <rect x="540" y="180" width="140" height="80" class="box" />
  <text x="610" y="215" text-anchor="middle" class="label">get_context()</text>

  <rect x="120" y="320" width="200" height="90" class="box" />
  <text x="220" y="350" text-anchor="middle" class="label">Context Providers — Read</text>
  <text x="130" y="380" class="small">mem0 (semantic search)</text>
  <text x="130" y="405" class="small">other providers (tools, policy)</text>

  <rect x="360" y="330" width="200" height="70" class="box" />
  <text x="460" y="365" text-anchor="middle" class="label">Merged Context</text>

  <rect x="600" y="330" width="120" height="70" class="box" />
  <text x="660" y="370" text-anchor="middle" class="label">LLM Call</text>

  <rect x="360" y="460" width="200" height="70" class="box" />
  <text x="460" y="500" text-anchor="middle" class="label">Context Providers — Write</text>
  <text x="370" y="530" class="small">mem0 / other providers</text>

  <rect x="600" y="460" width="120" height="70" class="box" />
  <text x="660" y="495" text-anchor="middle" class="label">Memory Stores</text>
  <text x="660" y="520" text-anchor="middle" class="small">(Vector DBs, KV)</text>

  <line x1="270" y1="220" x2="320" y2="220" class="arrow" />
  <line x1="490" y1="220" x2="540" y2="220" class="arrow" />
  <line x1="610" y1="260" x2="220" y2="320" class="arrow" />
  <line x1="320" y1="365" x2="360" y2="365" class="arrow" />
  <line x1="560" y1="365" x2="600" y2="365" class="arrow" />
  <line x1="660" y1="400" x2="460" y2="460" class="arrow" />
  <line x1="560" y1="495" x2="600" y2="495" class="arrow2" />

  <rect x="820" y="110" width="600" height="700" class="box" />
  <text x="1120" y="150" text-anchor="middle" class="section">2) Multi-level memory (hidden superpower)</text>

  <rect x="860" y="200" width="520" height="120" class="box" />
  <text x="1120" y="230" text-anchor="middle" class="label">Agents invoke context providers each turn</text>
  <text x="880" y="260" class="small">Agent A</text>
  <text x="1020" y="260" class="small">Agent B</text>
  <text x="1160" y="260" class="small">Agent C</text>

  <rect x="880" y="360" width="480" height="200" class="box" />
  <text x="1120" y="390" text-anchor="middle" class="label">Context Providers (read + write)</text>
  <text x="900" y="420" class="small">Short-term scratchpad</text>
  <text x="900" y="445" class="small">Long-term policy</text>
  <text x="900" y="470" class="small">Tool-specific memory</text>
  <text x="900" y="495" class="small">Persona / guardrail</text>
  <text x="900" y="520" class="small">User preference</text>

  <rect x="920" y="600" width="400" height="120" class="box" />
  <text x="1120" y="630" text-anchor="middle" class="label">Memory stores / lookups</text>
  <text x="940" y="660" class="small">Policy vector DB</text>
  <text x="940" y="685" class="small">Tool logs</text>
  <text x="940" y="710" class="small">Rules / prompts store</text>
  <text x="940" y="735" class="small">User profile DB</text>

  <line x1="1120" y1="320" x2="1120" y2="360" class="arrow" />
  <line x1="1120" y1="560" x2="1120" y2="600" class="arrow2" />
</svg>
